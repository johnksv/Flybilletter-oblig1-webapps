@model Flybilletter.Models.BestillingViewModel

@{
    ViewBag.Title = "Bestille";
}

<h2>Informasjon om bestilling</h2>

<h3>@Model.Fra - @Model.Til</h3>



@foreach (var item in Model.Flygninger)
{
    @Html.DisplayFor(model => item);
}

<hr />
<h3>Reisende</h3>



@for (int i = 0, antall = 1; i < Model.Kunder.Count; i++, antall++)
{
    using (Html.BeginForm(null, null, FormMethod.Post, new { id = "confirmForm" })) ///Home/BestillingDetaljer
    {
        @Html.AntiForgeryToken()
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Passasjer @antall</h3>
            </div>
            <div id="kundeInformasjon-@i" class="panel-body">
                @Html.EditorFor(model => model.Kunder[i], new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Kunder, "", new { @class = "text-danger" })

            </div>
            <div class="panel-footer">
                <button id="kundeInformasjonBtn-@i" class="btn btn-success">Bekreft informasjon</button>
            </div>
        </div>
    }
}

<div class="form-group">
    <div class="col-md-offset-2 col-md-10">
        <input type="submit" value="Lagre detaljer" class="btn btn-" />
    </div>
</div>



<div>
    @Html.ActionLink("Tilbake til søk", "Index")
</div>


<script>
    $(function () {
        var antallKunder = @Model.Kunder.Count;
        for (var i = 0; i < antallKunder; i++) {
            $("#kundeInformasjonBtn-" + i).click(function (event) {
                handleKundeInfoBtnClick(event, $(this).index() );
            });
        }
    });

    function handleKundeInfoBtnClick(event, idNr) {
        event.preventDefault();
        var btnId = "#kundeInformasjonBtn-" + idNr;
        var divId = "#kundeInformasjon-" + idNr;

        var isReadonly = $(divId + " :input").prop('readonly');
        var isValid = $("#confirmForm").valid();

        if (isReadonly) {
            $(btnId).text("Bekreft informasjon");
        } else if (isValid) {
            $(btnId).text("Endre informasjon");
        } else {
            return; //Hvis formen ikke er valid
        }

        $(divId + " :input").prop('readonly', !isReadonly);
        $(btnId).toggleClass("btn-success");
        $(btnId).toggleClass("btn-warning");
    }

</script>